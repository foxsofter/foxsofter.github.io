swagger: '2.0'
info:
  version: '1.0'
  title: 吾拉接口文档
host: 127.0.0.1:10010
basePath: /
#
schemes:
  - http
consumes:
  - application/json
produces:
  - application/json
paths:
  /v1/info:
    x-swagger-router-controller: infov1
    get:
      summary: Info 统一打包接口，适用于客户端第一次接入，会根据客户端类型返回后面的 info 接口返回的数据
      operationId: infoPack
      tags:
        - coach
        - user
        - clientresource
        - info
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        '200':
          description: 返回所有 /v1/info/ 下 除 time 之外其它子接口的数据
  /v1/info/system:
    x-swagger-router-controller: infov1
    get:
      summary: 获取系统信息，需要重新定义，可暂时不理会这个接口的数据
      operationId: systemInfo
      tags:
        - coach
        - user
        - clientresource
        - info
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        '200':
          description: 需要重新定义，可暂时不理会这个接口的数据
  /v1/info/categories:
    x-swagger-router-controller: infov1
    get:
      summary: 获取运动分类信息
      operationId: categories
      tags:
        - coach
        - user
        - clientresource
        - info
      parameters:
        - name: all
          in: query
          description: 是否获取其他分类，为 true 时只返回当前已经启用的运动分类
          type: boolean
          default: true
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 运动分类列表
          schema:
            type: array
            items:
              $ref: '#/definitions/Category'
  /v1/info/cities:
    x-swagger-router-controller: infov1
    get:
      summary: 城市列表接口
      operationId: cities
      tags:
        - coach
        - user
        - clientresource
        - info
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 城市列表
          schema:
            type: array
            items:
              $ref: '#/definitions/City'
  /v1/info/districts:
    x-swagger-router-controller: infov1
    get:
      summary: 行政区接口
      operationId: districts
      tags:
        - coach
        - user
        - clientresource
        - info
      parameters:
        - name: city
          in: query
          type: integer
          required: true
          description: 为 0 时获取所有城市的行政区，否则获取对应城市行政区
          default: 0
        - name: skip
          in: query
          type: integer
          description: 跳过记录数，接口一次返回 75 条数据
          default: 0
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 行政区列表
          schema:
            $ref: '#/definitions/DistrictList'
  /v1/info/time:
    x-swagger-router-controller: infov1
    get:
      summary: 返回服务器时间戳，带上 info 参数返回其它信息的最后更新时间戳
      operationId: time
      tags:
        - coach
        - user
        - clientresource
        - info
      parameters:
        - name: info
          in: query
          type: boolean
          description: 是否获取其它信息的最后更新时间戳
          default: false
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 服务器时间戳及服务器上其它信息的最后更新时间戳，用于判断是否调用对应信息的更新接口
  /v1/info/errorDescription:
    x-swagger-router-controller: infov1
    get:
      summary: 错误信息接口，用于客户端解读错误代码
      operationId: errorDescription
      tags:
        - coach
        - user
        - clientresource
        - info
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 错误信息列表
          schema:
            type: array
            items:
              $ref: '#/definitions/ErrorDescription'
  /v1/user/exists:
    x-swagger-router-controller: userv1
    post:
      summary: 检查用户名是否存在
      operationId: checkUserNameExists
      tags:
        - user
        - clientresource
      parameters:
        - name: body
          in: body
          required: true
          schema:
            type: object
            properties:
              username:
                type: string
                format: phone
                description: 待检查的用户名
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 用户名是否存在
          schema:
            type: object
            properties:
              exists:
                type: boolean
                description: 检查结果
  /v1/verification/{type}:
    x-swagger-router-controller: userv1
    post:
      summary: 发送验证码
      operationId: verificationCode
      tags:
        - user
        - clientresource
      parameters:
        - name: type
          in: path
          type: string
          enum: ['register', 'forget', 'coachLogin', 'wechat']
          required: true
          description: 发送短信类型 register-注册 forget-遗忘密码 coachLogin-教练登录 wechat-微信端
        - name: body
          in: body
          required: true
          schema:
            type: object
            properties:
              phone:
                type: string
                format: phone
                description: 接收短信的手机
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 返回经过加密的 code，供客户端自主判断验证码有效性
          schema:
            type: object
            properties:
              code:
                type: string
                description: 加密格式为 验证码|验证码过期时间戳 使用 client_secret 加密
  /v1/user:
    x-swagger-router-controller: userv1
    get:
      summary: 获取用户信息
      operationId: currentUserInfo
      tags:
        - user
        - userresource
        - self
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 目标用户信息
          schema:
            type: object
            properties:
              info:
                $ref: '#/definitions/UserSelfDetail'
    post:
      summary: 注册新用户
      operationId: userRegister
      tags:
        - user
        - clientresource
      parameters:
        - name: body
          in: body
          required: true
          schema:
            type: object
            properties:
              username:
                type: string
                format: phone
                description: 用户名，即手机号
              password:
                type: string
                format: password
                description: 密码
              nickname:
                type: string
                format: phone
                description: 昵称
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 注册成功，无报错就不需要关注返回信息
    put:
      summary: 修改用户信息，至少更新一项
      operationId: updateUserInfo
      tags:
        - user
        - userresource
        - self
      parameters:
        - name: body
          in: body
          required: true
          schema:
            type: object
            properties:
              nickname:
                type: string
                description: 昵称
              realname:
                type: string
                description: 真实姓名
              gender:
                type: string
                enum: ['male', 'female']
                description: 性别
              avatar:
                type: string
                description: 头像路径，上传方式查看七牛信息接口
              backgroundImage:
                type: string
                description: 用户资料页背景图路径，上传方式查看七牛信息接口
              birthday:
                type: integer
                description: 出生年月日八位数字
              city:
                type: integer
                description: 城市 ID
              district:
                type: integer
                description: 行政区 ID
              favoriteSports:
                type: array
                description: 运动分类数组
                items:
                  type: string
              bodyData:
                $ref: '#/definitions/BodyData'
              status:
                type: string
                description: 个性签名
              atNearby:
                type: boolean
                description: 是否在附近的人显示
              lastContact:
                $ref: '#/definitions/OrderContact'
              inviter:
                type: string
                description: 邀请人手机号
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 更新成功，无报错就不需要关注返回信息
  /v1/user/password:
    x-swagger-router-controller: userv1
    put:
      summary: 修改用户密码
      operationId: changePassword
      tags:
        - user
        - clientresource
        - self
      parameters:
        - name: body
          in: body
          required: true
          schema:
            type: object
            properties:
              username:
                type: string
                format: phone
                description: 手机号
              password:
                type: string
                format: password
                description: 新密码
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 更新成功，无报错就不需要关注返回信息
  /v1/user/{id}:
    x-swagger-router-controller: userv1
    get:
      summary: 获取用户信息
      operationId: userInfo
      tags:
        - user
        - userresource
        - social
      parameters:
        - name: id
          in: path
          type: string
          required: true
          description: 用户 ID
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 目标用户信息
          schema:
            type: object
            properties:
              info:
                $ref: '#/definitions/UserDetail'
              relation:
                $ref: '#/definitions/UserRelation'
  /v1/user/relation/{type}:
    x-swagger-router-controller: userv1
    get:
      summary: 查看当前用户的好友关系等，blocks 列表为简单的用户 ID 数组
      operationId: currentRelation
      tags:
        - user
        - userresource
        - self
        - social
      parameters:
        - name: type
          in: path
          required: true
          type: string
          description: 关系类型 friends-关注的 fans-关注ta的 blocks-拉黑的
          enum: ['friends', 'fans', 'blocks']
        - name: detail
          in: query
          required: false
          type: boolean
          default: true
          description: 是否获取详细信息，与 simple 互斥
        - name: simple
          in: query
          required: false
          type: boolean
          default: false
          description: 是否返回简单用户信息，仅包含用户ID、昵称、头像，与 detail 互斥
        - name: skip
          in: query
          type: integer
          description: 跳过记录数，接口一次返回 15 条数据， simple 模式下返回 300条
          default: 0
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 返回详细关系列表，simple 模式见 UserSimpleRelationList 定义
          schema:
            $ref: '#/definitions/UserRelationList'
  /v1/user/{id}/relation/{type}:
    x-swagger-router-controller: userv1
    get:
      summary: 查看指定用户的好友关系等，blocks 列表为简单的用户 ID 数组
      operationId: relation
      tags:
        - user
        - userresource
        - social
      parameters:
        - name: id
          in: path
          required: true
          type: string
          description: 用户ID
        - name: type
          in: path
          required: true
          type: string
          description: 关系类型 friends-关注的 fans-关注ta的 blocks-拉黑的
          enum: ['friends', 'fans', 'blocks']
        - name: detail
          in: query
          required: false
          type: boolean
          default: true
          description: 是否获取详细信息，与 simple 互斥
        - name: simple
          in: query
          required: false
          type: boolean
          default: false
          description: 是否返回简单用户信息，仅包含用户ID、昵称、头像，与 detail 互斥
        - name: skip
          in: query
          type: integer
          description: 跳过记录数，接口一次返回 15 条数据， simple 模式下返回 300条
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 返回简单关系列表，detail 模式见 UserRelationList 定义
          schema:
            $ref: '#/definitions/UserSimpleRelationList'
  /v1/user/groups:
    x-swagger-router-controller: userv1
    get:
      summary: 获取当前用户群组
      operationId: currentUserGroups
      tags:
        - user
        - userresource
        - group
        - self
        - social
      parameters:
        - name: category
          in: query
          required: false
          type: string
          description: 群组分类
        - name: search
          in: query
          required: false
          type: string
          description: 搜索关键词
        - name: skip
          required: false
          in: query
          type: integer
          description: 跳过记录数，接口一次返回 15 条数据
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 群组列表
          schema:
            $ref: '#/definitions/GroupList'
  /v1/user/{id}/groups:
    x-swagger-router-controller: userv1
    get:
      summary: 获取指定用户群组
      operationId: userGroups
      tags:
        - user
        - userresource
        - group
        - social
      parameters:
        - name: id
          in: path
          required: true
          type: string
          description: 用户ID
        - name: category
          in: query
          required: false
          type: string
          description: 群组分类
        - name: search
          in: query
          required: false
          type: string
          description: 搜索关键词
        - name: skip
          required: false
          in: query
          type: integer
          description: 跳过记录数，接口一次返回 15 条数据
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 群组列表
          schema:
            $ref: '#/definitions/GroupList'
  /v1/user/timeline:
    x-swagger-router-controller: userv1
    get:
      summary: 获取用户时间线
      operationId: currentTimeline
      tags:
        - user
        - userresource
        - self
        - social
      parameters:
        - name: skip
          in: query
          type: integer
          description: 跳过记录数，接口一次返回 15 条数据
        - name: lastupdate
          in: query
          type: integer
          description: 更新时间戳
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 时间线列表
          schema:
            $ref: '#/definitions/TimelineList'
  /v1/user/{id}/timeline:
    x-swagger-router-controller: userv1
    get:
      summary: 获取指定用户时间线
      operationId: timeline
      tags:
        - user
        - userresource
        - social
      parameters:
        - name: id
          in: path
          type: string
          required: true
          description: 指定用户ID
        - name: skip
          in: query
          type: integer
          description: 跳过记录数，接口一次返回 15 条数据
        - name: lastupdate
          in: query
          type: integer
          description: 更新时间戳
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 时间线列表
          schema:
            $ref: '#/definitions/TimelineList'
  /v1/user/likes/{type}:
    x-swagger-router-controller: userv1
    get:
      summary: 获取当前用户赞过的记录
      operationId: userLikes
      tags:
        - user
        - userresource
        - self
      parameters:
        - name: type
          in: path
          required: true
          type: string
          description: 类别，暂时只有 posts
          enum: ['posts']
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 点赞过的列表
          schema:
            $ref: '#/definitions/LikeList'
  /v1/user/search:
    x-swagger-router-controller: userv1
    post:
      summary: 通过手机号搜索用户
      operationId: searchUserByUsername
      tags:
        - user
        - userresource
      parameters:
        - name: body
          in: body
          required: true
          schema:
            type: object
            properties:
              phone:
                type: string
                format: phone
                description: 手机号
      responses:
        default:
          description: 出错
          schema:
            $ref: '#/definitions/ErrorResponse'
        200:
          description: 目标用户信息
          schema:
            type: object
            properties:
              info:
                $ref: '#/definitions/UserDetail'
              relation:
                $ref: '#/definitions/UserRelation'
  /swagger:
    x-swagger-pipe: swagger_raws
definitions:
  LikeList:
    allOf:
      - $ref: '#/definitions/ListBaseObject'
      - type: object
        properties:
          list:
            type: array
            items:
              type: string
  TimelineList:
    allOf:
      - $ref: '#/definitions/ListBaseObject'
      - type: object
        properties:
          list:
            type: array
            items:
              $ref: '#/definitions/UserTimeline'
  UserTimeline:
    type: object
    properties:
      id:
        type: string
        description: 动态ID
      type:
        type: string
        description: 时间线类型
      content:
        type: string
        description: 内容
      visible:
        type: string
        description: 可见性
      isTemaplte:
        type: boolean
        description: 是否是模版，模版需要解析
      createdAt:
        type: string
        format: datetime
        description: 发布时间
  GroupList:
    allOf:
      - $ref: '#/definitions/ListBaseObject'
      - type: object
        properties:
          list:
            type: array
            items:
              $ref: '#/definitions/Group'
  Group:
    type: object
    discriminator: id
    properties:
      id:
        type: string
        description: 群组ID
      channel:
        type: string
        description: 关联聊天频道ID
      categories:
        type: array
        description: 群组关联分类
        items:
          type: string
      name:
        type: string
        description: 群组名称
      description:
        type: string
        description: 群组描述
      notice:
        type: string
        description: 群组公告
      icon:
        type: string
        description: 群组icon路径
      type:
        type: string
        description: 群组类型，用户自建还是系统群组
        enum: ['system', 'user']
      memberCount:
        type: integer
        description: 群组成员数量
      isPublic:
        type: boolean
        description: 是否公开群组
      maxUsers:
        type: integer
        description: 最大成员数
      approval:
        type: boolean
        description: 加群是否需要批准
      invite:
        type: boolean
        description: 是否允许邀请入群
      recommend:
        type: boolean
        description: 是否是推荐群组
      tags:
        type: array
        description: 群组标签列表
        items:
          type: string
      createdBy:
        $ref: '#/definitions/GroupCreatedBy'
  GroupCreatedBy:
    allOf:
      - $ref: '#/definitions/UserBaseObject'
      - type: object
        properties:
          info:
            $ref: '#/definitions/UserInfo'
  UserRelationList:
    allOf:
      - $ref: '#/definitions/ListBaseObject'
      - type: object
        properties:
          list:
            type: array
            items:
              $ref: '#/definitions/UserRelationDetail'
  UserSimpleRelationList:
    allOf:
      - $ref: '#/definitions/ListBaseObject'
      - type: object
        properties:
          list:
            type: array
            items:
              $ref: '#/definitions/UserRelationSimple'
  UserRelationSimple:
    type: object
    discriminator: id
    properties:
      source:
        type: string
        description: 关系来源
      user:
        $ref: '#/definitions/UserSimple'
  UserRelationDetail:
    type: object
    discriminator: id
    properties:
      source:
        type: string
        description: 关系来源
      user:
        $ref: '#/definitions/UserDetail'
  UserSimple:
    type: object
    discriminator: id
    properties:
      id:
        type: string
        description: 用户ID
      nickname:
        type: string
        description: 昵称
      avatar:
        type: string
        description: 头像路径
  UserSelfDetail:
    allOf:
      - $ref: '#/definitions/UserBaseObject'
      - type: object
        properties:
          username:
            type: string
            description: 用户名，即手机号，只在访问用户自己资料的时候返回
          info:
            $ref: '#/definitions/UserInfo'
          extra:
            $ref: '#/definitions/UserExtra'
          easemob:
            $ref: '#/definitions/UserEaseMob'
  UserDetail:
    allOf:
      - $ref: '#/definitions/UserBaseObject'
      - type: object
        properties:
          info:
            $ref: '#/definitions/UserInfo'
          extra:
            $ref: '#/definitions/UserExtra'
  UserBaseObject:
    type: object
    discriminator: id
    properties:
      id:
        type: string
        description: 用户 ID
      verifyCoach:
        type: boolean
        description: 是否是认证教练
      enabled:
        type: boolean
        description: 是否被禁用
      area:
        type: integer
        description: 手机国家区号
      fixPassword:
        type: boolean
        description: 是否需要强制修改密码，教练端用于判断是否是第一次登录
      blockReason:
        type: string
        description: 被禁用的理由
      createdAt:
        type: string
        format: datetime
        description: 带时区的时间信息
  UserInfo:
    type: object
    properties:
      nickname:
        type: string
        description: 昵称
      realname:
        type: string
        description: 真实姓名
      gender:
        type: string
        enum: ['male', 'female']
        description: 性别
      avatar:
        type: string
        description: 头像路径，上传方式查看七牛信息接口
      backgroundImage:
        type: string
        description: 用户资料页背景图路径，上传方式查看七牛信息接口
      birthday:
        type: integer
        description: 出生年月日八位数字
      city:
        type: integer
        description: 城市 ID
      district:
        type: integer
        description: 行政区 ID
      favoriteSports:
        type: array
        description: 运动分类数组
        items:
          type: string
      bodyData:
        $ref: '#/definitions/BodyData'
      status:
        type: string
        description: 个性签名
  UserExtra:
    type: object
    properties:
      atNearby:
        type: boolean
        description: 是否在附近的人显示
      lastContact:
        $ref: '#/definitions/OrderContact'
      score:
        type: integer
        description: 积分
      lastlogin:
        type: string
        format: datetime
        description: 最后登录时间
      lastActivity:
        type: string
        format: datetime
        description: 最后活动时间
      friends:
        type: integer
        description: 朋友数
      fans:
        type: integer
        description: 粉丝数
      groups:
        type: integer
        description: 群组数
      linkWeChat:
        type: boolean
        description: 是否关联微信
      linkSina:
        type: boolean
        description: 是否关联新浪微博
      thirdParty:
        type: string
        description: 第三方帐号信息
  UserEaseMob:
    type: object
    properties:
      password:
        type: string
        description: 用户登录环信的密码
  UserRelation:
    type: object
    properties:
      isfriend:
        type: boolean
        description: 是否关注
      isfan:
        type: boolean
        description: 是否粉丝
      blockwithme:
        type: boolean
        description: 我是否 block 了 ta
      blockme:
        type: boolean
        description: ta 是否 block 了我
      favorited:
        type: boolean
        description: 我是否收藏了 ta
  BodyData:
    type: object
    properties:
      height:
        type: integer
        description: 身高，厘米
      weight:
        type: integer
        description: 体重，公斤
  OrderContact:
    type: object
    description: 保存的订单联系资料
    properties:
      name:
        type: string
        description: 联系人名称
      phone:
        type: string
        description: 联系人电话
  ErrorDescription:
    type: object
    discriminator: code
    properties:
      type:
        type: integer
        description: 错误信息隶属 http status code
      code:
        type: integer
        description: 系统中返回的错误代码
      error:
        type: array
        description: 错误名称，为 [中文,英文] 的结构
        items:
          type: string
  DistrictList:
    allOf:
      - $ref: '#/definitions/ListBaseObject'
      - type: object
        properties:
          list:
            type: array
            items:
              $ref: '#/definitions/District'
  District:
    type: object
    discriminator: id
    properties:
      id:
        type: integer
        description: 行政区 ID
      city:
        type: integer
        description: 城市 ID
      name:
        type: array
        description: 行政区名称，为 [中文,英文] 的结构
        items:
          type: string
  City:
    type: object
    discriminator: id
    properties:
      id:
        type: integer
        description: 城市 ID
      name:
        type: array
        description: 城市名称，为 [中文,英文] 的结构
        items:
          type: string
  Category:
    type: object
    discriminator: name
    properties:
      name:
        type: string
        description: 分类 ID，正常使用的变量
      lang:
        type: array
        description: 分类名称，为 [中文,英文] 的结构
        items:
          type: string
      color:
        type: string
        description: 要被遗弃的属性
      volume:
        type: string
        description: 定义分类的人数属性，考虑是否遗弃
  ListBaseObject:
    type: object
    properties:
      total:
        type: integer
        description: 记录总数
  ErrorResponse:
    required:
      - error_code
    properties:
      error_code:
        type: integer
